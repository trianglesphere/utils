#!/bin/zsh
##################################################
# Joshua's Backup Script
# Backups important files to an encrypted tarball
##################################################

# Backup the list of prgrams installed

pacman -Qe > ~/installed_programs.txt

# List all files to be backuped

config=(~/.zshrc ~/.zlogin ~/.zshenv ~/.histfile ~/.Xresources ~/.xinitrc \
~/.gitconfig ~/.xbindkeysrc ~/installed_programs.txt)

dot_folders=(~/.mozilla ~/.vim ~/.ssh ~/.config/i3 ~/.config/i3status)

folders=(~/Documents ~/Dropbox ~/Pictures ~/bin ~/utils)




backup_files=($config $dot_folders $folders)

# Backup location
dest='/mnt/backup'

# Naming the file
day=$(date +%F)
comp="desktop"
backup_name="$comp-backup-$day.tar.bz2"

# Running the commands
# Creates the tarball, encrypts it, moves it, then removes the tarball from the
    # home directory to the backup location. That step requires root priveleges
echo "Backing up $backup_files to $dest/$backup_name.gpg"
tar -cvjf ~/$backup_name $backup_files
echo

echo "The files will be encrypted using GPG symmetric encryption."
gpg -c ~/$backup_name 
echo

echo "File encrypted. Moving it to the backup location."
sudo mv ~/$backup_name.gpg $dest/$backup_name.gpg

# Clean up the generated files
rm ~/$backup_name
rm ~/installed_programs.txt

